<!DOCTYPE html>
<html>
  <head>
    <title>Stock Market Graph</title>
  </head>
  <body>
    <!-- OTHER IDEAS -->
    <!-- <canvas id="myChart"></canvas> -->
    <!-- https://www.youtube.com/watch?v=L3o_IEbfCRY -->
    <!-- https://www.chartjs.org/docs/latest/getting-started/ -->
    <!-- https://www.youtube.com/watch?v=4jfcxxTT8H0 -->

    <canvas
      id="graph"
      width="1500"
      height="1000"
      style="border: 1px solid black"
    ></canvas>
    <button onclick="cycle()">Run Cycle</button>
    <script>
      supdat = []; //supply values
      demdat = []; //demand values

      // first and last arguments for mathematical functions
      var maxX = 50;
      var minX = -maxX;
      // a elements for mathematical functions
      var a1 = 1.06;
      var a2 = 0.94;
      // b elements for mathematical functions
      var b1 = 1;
      var b2 = 1;

      for (i = minX; i <= maxX; i++) {
        //Adding calculated values of arguments to their respective arrays
        supdat.push(b1 * Math.pow(a1, i));
        demdat.push(b2 * Math.pow(a2, i));

        console.log("supply X:" + i + " Y:" + b1 * Math.pow(a1, i));
        console.log("demand X:" + i + " Y:" + b2 * Math.pow(a2, i));
      }

      // Get the canvas element
      var canvas = document.getElementById("graph");

      //variables used for coordinates and display
      var scaleX = canvas.width / (maxX * 2) - 0.5;
      var scaleY = canvas.height / (Math.max(...demdat) * 1.1);
      var positionX = canvas.width / 2; //pos 0 for X
      var positionY = canvas.height - scaleY; // pos 0 for Y

      //add drawing element
      var ctx = canvas.getContext("2d");

      //Draw function supply
      ctx.beginPath();
      ctx.moveTo(positionX + minX * scaleX, positionY - supdat[0] * scaleY);
      for (var i = minX; i < supdat.length; i++) {
        ctx.lineTo(
          positionX + i * scaleX,
          positionY - supdat[i + maxX] * scaleY
        );
      }
      ctx.strokeStyle = "blue"; //color blue
      ctx.stroke();
      ctx.closePath();

      //Draw function demand
      ctx.beginPath();
      ctx.moveTo(positionX + minX * scaleX, positionY - demdat[0] * scaleY);
      for (var i = minX; i < demdat.length; i++) {
        ctx.lineTo(
          positionX + i * scaleX,
          positionY - demdat[i + maxX] * scaleY
        );
      }
      ctx.strokeStyle = "red"; //color red
      ctx.stroke();
      ctx.closePath();

      // Draw scale/coordinates
      for (var i = 0; i < positionY / scaleY; i++) {
        ctx.font = "10px Arial";
        ctx.strokeText(i, positionX, positionY - i * scaleY);
      }

      for (var i = minX; i < maxX; i++) {
        ctx.font = "10px Arial";
        ctx.strokeText(i, positionX + i * scaleX, positionY);
      }
    </script>

    <script>
      //class creation for products
      class Product {
        constructor(
          id,
          name,
          basePrice,
          production,
          atractivness,
          demand,
          supply
        ) {
          //product properties creation
          this.id = id; // id of the product
          this.name = name; // name of the product

          this.basePrice = basePrice; //basic price of the product
          this.priceOffset = 0; // the offset of basePrice, used to determin the current price of the product

          this.production = production; // how much supply rises every cycle
          this.atractivness = atractivness; // how much demand rises every cycle

          this.demand = demand; //current demand of the product
          this.supply = supply; // current supply of the product
        }
        update() {
          // Decides by how much demand and supply will be reduced and if curPrice goes up or down
          var reduction;
          if (this.supply < this.demand) {
            reduction = this.demand - this.supply;
            //price up in progress
          } else {
            reduction = this.supply - this.demand;
            //price down in progress
          }

          //reduces demand and supply
          this.demand -= reduction;
          this.supply -= reduction;

          this.production += Math.pow(0.1, this.priceOffset);
          this.supply += Math.pow(1.1, this.priceOffset);
        }
      }

      function cycle() {
        psh();
        Update();
      }
    </script>
  </body>
</html>
