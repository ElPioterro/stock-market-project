<!DOCTYPE html>
<html>
  <head>
    <title>Display Excel Column as Line Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      function displayLineChart() {
        // Clear the previous chart instance, if any
        let oldChart = Chart.getChart("lineChart");
        if (oldChart) {
          oldChart.destroy();
        }

        let file = document.querySelector("input[type=file]").files[0];
        let reader = new FileReader();
        reader.onload = function (event) {
          let data = new Uint8Array(event.target.result);
          let workbook = XLSX.read(data, { type: "array" });
          let sheetName = workbook.SheetNames[0];
          let worksheet = workbook.Sheets[sheetName];
          //   let columnName = document
          //     .getElementById("columnName")
          //     .value.toUpperCase();
          let columnName = "Price of one action".toUpperCase();
          let range = XLSX.utils.decode_range(worksheet["!ref"]);
          let columnNumber;
          for (let i = range.s.c; i <= range.e.c; ++i) {
            let address = XLSX.utils.encode_cell({ r: range.s.r, c: i });
            let cell = worksheet[address];
            if (cell && cell.t === "s" && cell.v.toUpperCase() === columnName) {
              columnNumber = i;
              break;
            }
          }
          if (!columnNumber) {
            alert("Column not found!");
            return;
          }
          let columnData = XLSX.utils
            .sheet_to_json(worksheet, { header: 1 })
            .map(function (row) {
              return row[columnNumber];
            })
            .slice(1); // exclude header row
          let chartData = {
            labels: Array.from({ length: columnData.length }, function (_, i) {
              return i;
            }),
            datasets: [
              {
                label: columnName,
                data: columnData,
                borderColor: "rgba(255, 99, 132, 1)",
                fill: false,
              },
            ],
          };
          let chartOptions = {
            scales: {
              y: {
                ticks: {
                  beginAtZero: true,
                },
              },
              // https://stackoverflow.com/questions/72664130/chartjs-invalid-scale-configuration-for-scale-xaxes
              // Syntax V2
              //   yAxes: [
              //     {
              //       ticks: {
              //         beginAtZero: true,
              //       },
              //     },
              //   ],
            },
          };
          let chartCtx = document.getElementById("lineChart").getContext("2d");
          let lineChart = new Chart(chartCtx, {
            type: "line",
            data: chartData,
            options: chartOptions,
          });
        };
        reader.readAsArrayBuffer(file);
      }
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Line Chart Generator</h1>
      <!-- <div class="form-group">
        <label for="columnName">Enter column name:</label>
        <input type="text" id="columnName" class="form-control" placeholder="Column Name" />
      </div> -->
      <div class="form-group">
        <label for="fileInput">Upload Excel File:</label>
        <input
          type="file"
          id="fileInput"
          accept=".xls,.xlsx"
          class="form-control-file"
        />
      </div>
      <div class="form-group mt-4">
        <button onclick="displayLineChart()" class="btn btn-primary">
          Generate Chart
        </button>
      </div>
      <div class="chart-container mt-5">
        <canvas id="lineChart"></canvas>
      </div>
    </div>

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />

    <!-- jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
</html>
